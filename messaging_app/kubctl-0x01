#!/bin/bash

# kubctl-0x01 - Task 2: Scaling the application
# This script scales the messaging app to 3 replicas and tests it

echo "ðŸ“Š Task 2: Scaling the Messaging App"
echo "======================================"
echo ""

echo "ðŸ” Current deployment status:"
kubectl get deployment messaging-app-deployment

echo ""
echo "â¬†ï¸  Scaling to 3 replicas..."
kubectl scale deployment messaging-app-deployment --replicas=3

echo ""
echo "â³ Waiting for all pods to be ready..."
kubectl wait --for=condition=ready pod -l app=messaging-app --timeout=60s

echo ""
echo "âœ… Current pods running:"
kubectl get pods -l app=messaging-app -o wide

echo ""
echo "ðŸ“ˆ Deployment scaled successfully!"
kubectl get deployment messaging-app-deployment

echo ""
echo "ðŸ§ª Testing load distribution across pods..."
echo "Getting pod IPs..."
kubectl get pods -l app=messaging-app -o jsonpath='{.items[*].status.podIP}'

echo ""
echo ""
echo "ðŸ“Š Resource usage by pods:"
kubectl top pods -l app=messaging-app 2>/dev/null || echo "Note: Install metrics-server for resource monitoring"

echo ""
echo "ðŸŽ‰ Scaling test complete!"
echo "Your app now has 3 replicas handling traffic!"

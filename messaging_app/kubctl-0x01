#!/bin/bash

# kubctl-0x01 - Task 2: Scaling the application
# This script scales the messaging app to 3 replicas and tests it

echo "📊 Task 2: Scaling the Messaging App"
echo "======================================"
echo ""

echo "🔍 Current deployment status:"
kubectl get deployment messaging-app-deployment

echo ""
echo "⬆️  Scaling to 3 replicas..."
kubectl scale deployment messaging-app-deployment --replicas=3

echo ""
echo "⏳ Waiting for all pods to be ready..."
kubectl wait --for=condition=ready pod -l app=messaging-app --timeout=60s

echo ""
echo "✅ Current pods running:"
kubectl get pods -l app=messaging-app -o wide

echo ""
echo "📈 Deployment scaled successfully!"
kubectl get deployment messaging-app-deployment

echo ""
echo "🧪 Testing load distribution across pods..."
echo "Getting pod IPs..."
kubectl get pods -l app=messaging-app -o jsonpath='{.items[*].status.podIP}'

echo ""
echo ""
echo "📊 Resource usage by pods:"
kubectl top pods -l app=messaging-app 2>/dev/null || echo "Note: Install metrics-server for resource monitoring"

echo ""
echo "🎉 Scaling test complete!"
echo "Your app now has 3 replicas handling traffic!"
